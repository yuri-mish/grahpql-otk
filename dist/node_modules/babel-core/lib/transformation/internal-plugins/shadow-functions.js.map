{"version":3,"sources":["../../../../../../node_modules/babel-core/lib/transformation/internal-plugins/shadow-functions.js"],"names":["exports","__esModule","_symbol","require","_symbol2","_interopRequireDefault","_plugin","_plugin2","_babelTypes","t","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","SUPER_THIS_BOUND","superVisitor","CallExpression","path","get","isSuper","node","replaceWith","assignmentExpression","id","name","visitor","ThisExpression","remap","ReferencedIdentifier","shouldShadow","shadowPath","is","inShadow","shadowFunction","_shadowedFunctionLiteral","currentFunction","passedShadowFunction","fnPath","find","innerPath","parentPath","isClassProperty","isProgram","isFunction","isArrowFunctionExpression","findParent","p","cached","getData","scope","generateUidIdentifier","setData","classPath","isClass","hasSuperClass","superClass","isMethod","kind","push","traverse","init","thisExpression","identifier","cloneDeep","loc","module"],"mappings":"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","file":"shadow-functions.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _symbol = require(\"babel-runtime/core-js/symbol\");\n\nvar _symbol2 = _interopRequireDefault(_symbol);\n\nvar _plugin = require(\"../plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar SUPER_THIS_BOUND = (0, _symbol2.default)(\"super this bound\");\n\nvar superVisitor = {\n  CallExpression: function CallExpression(path) {\n    if (!path.get(\"callee\").isSuper()) return;\n\n    var node = path.node;\n\n    if (node[SUPER_THIS_BOUND]) return;\n    node[SUPER_THIS_BOUND] = true;\n\n    path.replaceWith(t.assignmentExpression(\"=\", this.id, node));\n  }\n};\n\nexports.default = new _plugin2.default({\n  name: \"internal.shadowFunctions\",\n\n  visitor: {\n    ThisExpression: function ThisExpression(path) {\n      remap(path, \"this\");\n    },\n    ReferencedIdentifier: function ReferencedIdentifier(path) {\n      if (path.node.name === \"arguments\") {\n        remap(path, \"arguments\");\n      }\n    }\n  }\n});\n\n\nfunction shouldShadow(path, shadowPath) {\n  if (path.is(\"_forceShadow\")) {\n    return true;\n  } else {\n    return shadowPath;\n  }\n}\n\nfunction remap(path, key) {\n  var shadowPath = path.inShadow(key);\n  if (!shouldShadow(path, shadowPath)) return;\n\n  var shadowFunction = path.node._shadowedFunctionLiteral;\n\n  var currentFunction = void 0;\n  var passedShadowFunction = false;\n\n  var fnPath = path.find(function (innerPath) {\n    if (innerPath.parentPath && innerPath.parentPath.isClassProperty() && innerPath.key === \"value\") {\n      return true;\n    }\n    if (path === innerPath) return false;\n    if (innerPath.isProgram() || innerPath.isFunction()) {\n      currentFunction = currentFunction || innerPath;\n    }\n\n    if (innerPath.isProgram()) {\n      passedShadowFunction = true;\n\n      return true;\n    } else if (innerPath.isFunction() && !innerPath.isArrowFunctionExpression()) {\n      if (shadowFunction) {\n        if (innerPath === shadowFunction || innerPath.node === shadowFunction.node) return true;\n      } else {\n        if (!innerPath.is(\"shadow\")) return true;\n      }\n\n      passedShadowFunction = true;\n      return false;\n    }\n\n    return false;\n  });\n\n  if (shadowFunction && fnPath.isProgram() && !shadowFunction.isProgram()) {\n    fnPath = path.findParent(function (p) {\n      return p.isProgram() || p.isFunction();\n    });\n  }\n\n  if (fnPath === currentFunction) return;\n\n  if (!passedShadowFunction) return;\n\n  var cached = fnPath.getData(key);\n  if (!cached) {\n    var id = path.scope.generateUidIdentifier(key);\n\n    fnPath.setData(key, id);\n    cached = id;\n\n    var classPath = fnPath.findParent(function (p) {\n      return p.isClass();\n    });\n    var hasSuperClass = !!(classPath && classPath.node && classPath.node.superClass);\n\n    if (key === \"this\" && fnPath.isMethod({ kind: \"constructor\" }) && hasSuperClass) {\n      fnPath.scope.push({ id: id });\n\n      fnPath.traverse(superVisitor, { id: id });\n    } else {\n      var init = key === \"this\" ? t.thisExpression() : t.identifier(key);\n\n      if (shadowFunction) init._shadowedFunctionLiteral = shadowFunction;\n\n      fnPath.scope.push({ id: id, init: init });\n    }\n  }\n\n  var node = t.cloneDeep(cached);\n  node.loc = path.node.loc;\n\n  return path.replaceWith(node);\n}\nmodule.exports = exports[\"default\"];"]}