{"version":3,"sources":["../../../../../../../node_modules/babel-core/lib/transformation/file/options/build-config-chain.js"],"names":["exports","__esModule","_assign","require","_assign2","_interopRequireDefault","_classCallCheck2","_classCallCheck3","default","buildConfigChain","_resolve","_resolve2","_json","_json2","_pathIsAbsolute","_pathIsAbsolute2","_path","_path2","_fs","_fs2","obj","existsCache","jsonCache","BABELIGNORE_FILENAME","BABELRC_FILENAME","PACKAGE_FILENAME","exists","filename","cached","existsSync","opts","arguments","length","undefined","log","builder","ConfigChainBuilder","babelrc","findConfigs","mergeConfig","options","alias","dirname","configs","resolvedConfigs","prototype","loc","join","process","cwd","foundConfig","foundIgnore","configLoc","addConfig","pkgLoc","JSON","ignoreLoc","addIgnoreConfig","file","readFileSync","lines","split","map","line","replace","trim","filter","ignore","key","json","indexOf","push","content","parse","err","message","_ref","extends","extendsLoc","error","envOpts","envKey","env","BABEL_ENV","NODE_ENV","module"],"mappings":"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","file":"build-config-chain.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _assign = require(\"babel-runtime/core-js/object/assign\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nexports.default = buildConfigChain;\n\nvar _resolve = require(\"../../../helpers/resolve\");\n\nvar _resolve2 = _interopRequireDefault(_resolve);\n\nvar _json = require(\"json5\");\n\nvar _json2 = _interopRequireDefault(_json);\n\nvar _pathIsAbsolute = require(\"path-is-absolute\");\n\nvar _pathIsAbsolute2 = _interopRequireDefault(_pathIsAbsolute);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _fs = require(\"fs\");\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar existsCache = {};\nvar jsonCache = {};\n\nvar BABELIGNORE_FILENAME = \".babelignore\";\nvar BABELRC_FILENAME = \".babelrc\";\nvar PACKAGE_FILENAME = \"package.json\";\n\nfunction exists(filename) {\n  var cached = existsCache[filename];\n  if (cached == null) {\n    return existsCache[filename] = _fs2.default.existsSync(filename);\n  } else {\n    return cached;\n  }\n}\n\nfunction buildConfigChain() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var log = arguments[1];\n\n  var filename = opts.filename;\n  var builder = new ConfigChainBuilder(log);\n\n  if (opts.babelrc !== false) {\n    builder.findConfigs(filename);\n  }\n\n  builder.mergeConfig({\n    options: opts,\n    alias: \"base\",\n    dirname: filename && _path2.default.dirname(filename)\n  });\n\n  return builder.configs;\n}\n\nvar ConfigChainBuilder = function () {\n  function ConfigChainBuilder(log) {\n    (0, _classCallCheck3.default)(this, ConfigChainBuilder);\n\n    this.resolvedConfigs = [];\n    this.configs = [];\n    this.log = log;\n  }\n\n  ConfigChainBuilder.prototype.findConfigs = function findConfigs(loc) {\n    if (!loc) return;\n\n    if (!(0, _pathIsAbsolute2.default)(loc)) {\n      loc = _path2.default.join(process.cwd(), loc);\n    }\n\n    var foundConfig = false;\n    var foundIgnore = false;\n\n    while (loc !== (loc = _path2.default.dirname(loc))) {\n      if (!foundConfig) {\n        var configLoc = _path2.default.join(loc, BABELRC_FILENAME);\n        if (exists(configLoc)) {\n          this.addConfig(configLoc);\n          foundConfig = true;\n        }\n\n        var pkgLoc = _path2.default.join(loc, PACKAGE_FILENAME);\n        if (!foundConfig && exists(pkgLoc)) {\n          foundConfig = this.addConfig(pkgLoc, \"babel\", JSON);\n        }\n      }\n\n      if (!foundIgnore) {\n        var ignoreLoc = _path2.default.join(loc, BABELIGNORE_FILENAME);\n        if (exists(ignoreLoc)) {\n          this.addIgnoreConfig(ignoreLoc);\n          foundIgnore = true;\n        }\n      }\n\n      if (foundIgnore && foundConfig) return;\n    }\n  };\n\n  ConfigChainBuilder.prototype.addIgnoreConfig = function addIgnoreConfig(loc) {\n    var file = _fs2.default.readFileSync(loc, \"utf8\");\n    var lines = file.split(\"\\n\");\n\n    lines = lines.map(function (line) {\n      return line.replace(/#(.*?)$/, \"\").trim();\n    }).filter(function (line) {\n      return !!line;\n    });\n\n    if (lines.length) {\n      this.mergeConfig({\n        options: { ignore: lines },\n        alias: loc,\n        dirname: _path2.default.dirname(loc)\n      });\n    }\n  };\n\n  ConfigChainBuilder.prototype.addConfig = function addConfig(loc, key) {\n    var json = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _json2.default;\n\n    if (this.resolvedConfigs.indexOf(loc) >= 0) {\n      return false;\n    }\n\n    this.resolvedConfigs.push(loc);\n\n    var content = _fs2.default.readFileSync(loc, \"utf8\");\n    var options = void 0;\n\n    try {\n      options = jsonCache[content] = jsonCache[content] || json.parse(content);\n      if (key) options = options[key];\n    } catch (err) {\n      err.message = loc + \": Error while parsing JSON - \" + err.message;\n      throw err;\n    }\n\n    this.mergeConfig({\n      options: options,\n      alias: loc,\n      dirname: _path2.default.dirname(loc)\n    });\n\n    return !!options;\n  };\n\n  ConfigChainBuilder.prototype.mergeConfig = function mergeConfig(_ref) {\n    var options = _ref.options,\n        alias = _ref.alias,\n        loc = _ref.loc,\n        dirname = _ref.dirname;\n\n    if (!options) {\n      return false;\n    }\n\n    options = (0, _assign2.default)({}, options);\n\n    dirname = dirname || process.cwd();\n    loc = loc || alias;\n\n    if (options.extends) {\n      var extendsLoc = (0, _resolve2.default)(options.extends, dirname);\n      if (extendsLoc) {\n        this.addConfig(extendsLoc);\n      } else {\n        if (this.log) this.log.error(\"Couldn't resolve extends clause of \" + options.extends + \" in \" + alias);\n      }\n      delete options.extends;\n    }\n\n    this.configs.push({\n      options: options,\n      alias: alias,\n      loc: loc,\n      dirname: dirname\n    });\n\n    var envOpts = void 0;\n    var envKey = process.env.BABEL_ENV || process.env.NODE_ENV || \"development\";\n    if (options.env) {\n      envOpts = options.env[envKey];\n      delete options.env;\n    }\n\n    this.mergeConfig({\n      options: envOpts,\n      alias: alias + \".env.\" + envKey,\n      dirname: dirname\n    });\n  };\n\n  return ConfigChainBuilder;\n}();\n\nmodule.exports = exports[\"default\"];"]}