{"version":3,"sources":["../../../../../node_modules/express/lib/router/layer.js"],"names":["pathRegexp","require","debug","hasOwnProperty","Object","prototype","module","exports","Layer","path","options","fn","opts","handle","name","params","undefined","regexp","keys","fast_star","fast_slash","end","handle_error","error","req","res","next","length","err","handle_request","match","decode_param","exec","i","key","prop","val","call","decodeURIComponent","URIError","message","status","statusCode"],"mappings":"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","file":"layer.js","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar pathRegexp = require('path-to-regexp');\nvar debug = require('debug')('express:router:layer');\n\n/**\n * Module variables.\n * @private\n */\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = Layer;\n\nfunction Layer(path, options, fn) {\n  if (!(this instanceof Layer)) {\n    return new Layer(path, options, fn);\n  }\n\n  debug('new %o', path)\n  var opts = options || {};\n\n  this.handle = fn;\n  this.name = fn.name || '<anonymous>';\n  this.params = undefined;\n  this.path = undefined;\n  this.regexp = pathRegexp(path, this.keys = [], opts);\n\n  // set fast path flags\n  this.regexp.fast_star = path === '*'\n  this.regexp.fast_slash = path === '/' && opts.end === false\n}\n\n/**\n * Handle the error for the layer.\n *\n * @param {Error} error\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\n\nLayer.prototype.handle_error = function handle_error(error, req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length !== 4) {\n    // not a standard error handler\n    return next(error);\n  }\n\n  try {\n    fn(error, req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Handle the request for the layer.\n *\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\n\nLayer.prototype.handle_request = function handle(req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length > 3) {\n    // not a standard request handler\n    return next();\n  }\n\n  try {\n    fn(req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Check if this route matches `path`, if so\n * populate `.params`.\n *\n * @param {String} path\n * @return {Boolean}\n * @api private\n */\n\nLayer.prototype.match = function match(path) {\n  var match\n\n  if (path != null) {\n    // fast path non-ending match for / (any path matches)\n    if (this.regexp.fast_slash) {\n      this.params = {}\n      this.path = ''\n      return true\n    }\n\n    // fast path for * (everything matched in a param)\n    if (this.regexp.fast_star) {\n      this.params = {'0': decode_param(path)}\n      this.path = path\n      return true\n    }\n\n    // match the path\n    match = this.regexp.exec(path)\n  }\n\n  if (!match) {\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  // store values\n  this.params = {};\n  this.path = match[0]\n\n  var keys = this.keys;\n  var params = this.params;\n\n  for (var i = 1; i < match.length; i++) {\n    var key = keys[i - 1];\n    var prop = key.name;\n    var val = decode_param(match[i])\n\n    if (val !== undefined || !(hasOwnProperty.call(params, prop))) {\n      params[prop] = val;\n    }\n  }\n\n  return true;\n};\n\n/**\n * Decode param value.\n *\n * @param {string} val\n * @return {string}\n * @private\n */\n\nfunction decode_param(val) {\n  if (typeof val !== 'string' || val.length === 0) {\n    return val;\n  }\n\n  try {\n    return decodeURIComponent(val);\n  } catch (err) {\n    if (err instanceof URIError) {\n      err.message = 'Failed to decode param \\'' + val + '\\'';\n      err.status = err.statusCode = 400;\n    }\n\n    throw err;\n  }\n}\n"]}