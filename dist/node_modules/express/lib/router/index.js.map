{"version":3,"sources":["../../../../../node_modules/express/lib/router/index.js"],"names":["Route","require","Layer","methods","mixin","debug","deprecate","flatten","parseUrl","setPrototypeOf","objectRegExp","slice","Array","prototype","toString","Object","proto","module","exports","options","opts","router","req","res","next","handle","params","_params","caseSensitive","mergeParams","strict","stack","param","name","fn","push","len","length","ret","JSON","stringify","substr","i","Error","out","self","method","url","idx","protohost","getProtohost","removed","slashAdded","paramcalled","parentParams","parentUrl","baseUrl","done","restore","wrap","old","err","sendOptionsResponse","originalUrl","layerError","setImmediate","path","getPathname","layer","match","route","matchLayer","has_method","_handles_method","appendMethods","_options","layerPath","process_params","handle_request","trim_prefix","c","substring","handle_error","called","keys","paramIndex","key","paramVal","paramCallbacks","paramCalled","undefined","error","value","paramCallback","e","use","offset","arg","isArray","callbacks","call","arguments","TypeError","gettype","sensitive","end","dispatch","bind","concat","forEach","apply","list","addition","indexOf","pathname","searchIndex","pathLength","fqdnIndex","obj","type","replace","parent","o","props","vals","body","join","set","send","proxy","args"],"mappings":"AAAA;;;;;;;;AAQA;;AAEA;;;;;AAKA,IAAIA,QAAQC,QAAQ,SAAR,CAAZ;AACA,IAAIC,QAAQD,QAAQ,SAAR,CAAZ;AACA,IAAIE,UAAUF,QAAQ,SAAR,CAAd;AACA,IAAIG,QAAQH,QAAQ,aAAR,CAAZ;AACA,IAAII,QAAQJ,QAAQ,OAAR,EAAiB,gBAAjB,CAAZ;AACA,IAAIK,YAAYL,QAAQ,MAAR,EAAgB,SAAhB,CAAhB;AACA,IAAIM,UAAUN,QAAQ,eAAR,CAAd;AACA,IAAIO,WAAWP,QAAQ,UAAR,CAAf;AACA,IAAIQ,iBAAiBR,QAAQ,gBAAR,CAArB;;AAEA;;;;;AAKA,IAAIS,eAAe,oBAAnB;AACA,IAAIC,QAAQC,MAAMC,SAAN,CAAgBF,KAA5B;AACA,IAAIG,WAAWC,OAAOF,SAAP,CAAiBC,QAAhC;;AAEA;;;;;;;;AAQA,IAAIE,QAAQC,OAAOC,OAAP,GAAiB,UAASC,OAAT,EAAkB;AAC7C,MAAIC,OAAOD,WAAW,EAAtB;;AAEA,WAASE,MAAT,CAAgBC,GAAhB,EAAqBC,GAArB,EAA0BC,IAA1B,EAAgC;AAC9BH,WAAOI,MAAP,CAAcH,GAAd,EAAmBC,GAAnB,EAAwBC,IAAxB;AACD;;AAED;AACAf,iBAAeY,MAAf,EAAuBL,KAAvB;;AAEAK,SAAOK,MAAP,GAAgB,EAAhB;AACAL,SAAOM,OAAP,GAAiB,EAAjB;AACAN,SAAOO,aAAP,GAAuBR,KAAKQ,aAA5B;AACAP,SAAOQ,WAAP,GAAqBT,KAAKS,WAA1B;AACAR,SAAOS,MAAP,GAAgBV,KAAKU,MAArB;AACAT,SAAOU,KAAP,GAAe,EAAf;;AAEA,SAAOV,MAAP;AACD,CAlBD;;AAoBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCAL,MAAMgB,KAAN,GAAc,SAASA,KAAT,CAAeC,IAAf,EAAqBC,EAArB,EAAyB;AACrC;AACA,MAAI,OAAOD,IAAP,KAAgB,UAApB,EAAgC;AAC9B3B,cAAU,+CAAV;AACA,SAAKqB,OAAL,CAAaQ,IAAb,CAAkBF,IAAlB;AACA;AACD;;AAED;AACA,MAAIP,SAAS,KAAKC,OAAlB;AACA,MAAIS,MAAMV,OAAOW,MAAjB;AACA,MAAIC,GAAJ;;AAEA,MAAIL,KAAK,CAAL,MAAY,GAAhB,EAAqB;AACnB3B,cAAU,kBAAkBiC,KAAKC,SAAL,CAAeP,IAAf,CAAlB,GAAyC,0BAAzC,GAAsEM,KAAKC,SAAL,CAAeP,KAAKQ,MAAL,CAAY,CAAZ,CAAf,CAAtE,GAAuG,eAAjH;AACAR,WAAOA,KAAKQ,MAAL,CAAY,CAAZ,CAAP;AACD;;AAED,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIN,GAApB,EAAyB,EAAEM,CAA3B,EAA8B;AAC5B,QAAIJ,MAAMZ,OAAOgB,CAAP,EAAUT,IAAV,EAAgBC,EAAhB,CAAV,EAA+B;AAC7BA,WAAKI,GAAL;AACD;AACF;;AAED;AACA;AACA,MAAI,eAAe,OAAOJ,EAA1B,EAA8B;AAC5B,UAAM,IAAIS,KAAJ,CAAU,8BAA8BV,IAA9B,GAAqC,QAArC,GAAgDC,EAA1D,CAAN;AACD;;AAED,GAAC,KAAKR,MAAL,CAAYO,IAAZ,IAAoB,KAAKP,MAAL,CAAYO,IAAZ,KAAqB,EAA1C,EAA8CE,IAA9C,CAAmDD,EAAnD;AACA,SAAO,IAAP;AACD,CAhCD;;AAkCA;;;;;AAKAlB,MAAMS,MAAN,GAAe,SAASA,MAAT,CAAgBH,GAAhB,EAAqBC,GAArB,EAA0BqB,GAA1B,EAA+B;AAC5C,MAAIC,OAAO,IAAX;;AAEAxC,QAAM,mBAAN,EAA2BiB,IAAIwB,MAA/B,EAAuCxB,IAAIyB,GAA3C;;AAEA,MAAIC,MAAM,CAAV;AACA,MAAIC,YAAYC,aAAa5B,IAAIyB,GAAjB,KAAyB,EAAzC;AACA,MAAII,UAAU,EAAd;AACA,MAAIC,aAAa,KAAjB;AACA,MAAIC,cAAc,EAAlB;;AAEA;AACA;AACA,MAAIlC,UAAU,EAAd;;AAEA;AACA,MAAIY,QAAQc,KAAKd,KAAjB;;AAEA;AACA,MAAIuB,eAAehC,IAAII,MAAvB;AACA,MAAI6B,YAAYjC,IAAIkC,OAAJ,IAAe,EAA/B;AACA,MAAIC,OAAOC,QAAQd,GAAR,EAAatB,GAAb,EAAkB,SAAlB,EAA6B,MAA7B,EAAqC,QAArC,CAAX;;AAEA;AACAA,MAAIE,IAAJ,GAAWA,IAAX;;AAEA;AACA,MAAIF,IAAIwB,MAAJ,KAAe,SAAnB,EAA8B;AAC5BW,WAAOE,KAAKF,IAAL,EAAW,UAASG,GAAT,EAAcC,GAAd,EAAmB;AACnC,UAAIA,OAAO1C,QAAQkB,MAAR,KAAmB,CAA9B,EAAiC,OAAOuB,IAAIC,GAAJ,CAAP;AACjCC,0BAAoBvC,GAApB,EAAyBJ,OAAzB,EAAkCyC,GAAlC;AACD,KAHM,CAAP;AAID;;AAED;AACAtC,MAAIkC,OAAJ,GAAcD,SAAd;AACAjC,MAAIyC,WAAJ,GAAkBzC,IAAIyC,WAAJ,IAAmBzC,IAAIyB,GAAzC;;AAEAvB;;AAEA,WAASA,IAAT,CAAcqC,GAAd,EAAmB;AACjB,QAAIG,aAAaH,QAAQ,OAAR,GACb,IADa,GAEbA,GAFJ;;AAIA;AACA,QAAIT,UAAJ,EAAgB;AACd9B,UAAIyB,GAAJ,GAAUzB,IAAIyB,GAAJ,CAAQN,MAAR,CAAe,CAAf,CAAV;AACAW,mBAAa,KAAb;AACD;;AAED;AACA,QAAID,QAAQd,MAAR,KAAmB,CAAvB,EAA0B;AACxBf,UAAIkC,OAAJ,GAAcD,SAAd;AACAjC,UAAIyB,GAAJ,GAAUE,YAAYE,OAAZ,GAAsB7B,IAAIyB,GAAJ,CAAQN,MAAR,CAAeQ,UAAUZ,MAAzB,CAAhC;AACAc,gBAAU,EAAV;AACD;;AAED;AACA,QAAIa,eAAe,QAAnB,EAA6B;AAC3BC,mBAAaR,IAAb,EAAmB,IAAnB;AACA;AACD;;AAED;AACA,QAAIT,OAAOjB,MAAMM,MAAjB,EAAyB;AACvB4B,mBAAaR,IAAb,EAAmBO,UAAnB;AACA;AACD;;AAED;AACA,QAAIE,OAAOC,YAAY7C,GAAZ,CAAX;;AAEA,QAAI4C,QAAQ,IAAZ,EAAkB;AAChB,aAAOT,KAAKO,UAAL,CAAP;AACD;;AAED;AACA,QAAII,KAAJ;AACA,QAAIC,KAAJ;AACA,QAAIC,KAAJ;;AAEA,WAAOD,UAAU,IAAV,IAAkBrB,MAAMjB,MAAMM,MAArC,EAA6C;AAC3C+B,cAAQrC,MAAMiB,KAAN,CAAR;AACAqB,cAAQE,WAAWH,KAAX,EAAkBF,IAAlB,CAAR;AACAI,cAAQF,MAAME,KAAd;;AAEA,UAAI,OAAOD,KAAP,KAAiB,SAArB,EAAgC;AAC9B;AACAL,qBAAaA,cAAcK,KAA3B;AACD;;AAED,UAAIA,UAAU,IAAd,EAAoB;AAClB;AACD;;AAED,UAAI,CAACC,KAAL,EAAY;AACV;AACA;AACD;;AAED,UAAIN,UAAJ,EAAgB;AACd;AACAK,gBAAQ,KAAR;AACA;AACD;;AAED,UAAIvB,SAASxB,IAAIwB,MAAjB;AACA,UAAI0B,aAAaF,MAAMG,eAAN,CAAsB3B,MAAtB,CAAjB;;AAEA;AACA,UAAI,CAAC0B,UAAD,IAAe1B,WAAW,SAA9B,EAAyC;AACvC4B,sBAAcvD,OAAd,EAAuBmD,MAAMK,QAAN,EAAvB;AACD;;AAED;AACA,UAAI,CAACH,UAAD,IAAe1B,WAAW,MAA9B,EAAsC;AACpCuB,gBAAQ,KAAR;AACA;AACD;AACF;;AAED;AACA,QAAIA,UAAU,IAAd,EAAoB;AAClB,aAAOZ,KAAKO,UAAL,CAAP;AACD;;AAED;AACA,QAAIM,KAAJ,EAAW;AACThD,UAAIgD,KAAJ,GAAYA,KAAZ;AACD;;AAED;AACAhD,QAAII,MAAJ,GAAamB,KAAKhB,WAAL,GACTA,YAAYuC,MAAM1C,MAAlB,EAA0B4B,YAA1B,CADS,GAETc,MAAM1C,MAFV;AAGA,QAAIkD,YAAYR,MAAMF,IAAtB;;AAEA;AACArB,SAAKgC,cAAL,CAAoBT,KAApB,EAA2Bf,WAA3B,EAAwC/B,GAAxC,EAA6CC,GAA7C,EAAkD,UAAUsC,GAAV,EAAe;AAC/D,UAAIA,GAAJ,EAAS;AACP,eAAOrC,KAAKwC,cAAcH,GAAnB,CAAP;AACD;;AAED,UAAIS,KAAJ,EAAW;AACT,eAAOF,MAAMU,cAAN,CAAqBxD,GAArB,EAA0BC,GAA1B,EAA+BC,IAA/B,CAAP;AACD;;AAEDuD,kBAAYX,KAAZ,EAAmBJ,UAAnB,EAA+BY,SAA/B,EAA0CV,IAA1C;AACD,KAVD;AAWD;;AAED,WAASa,WAAT,CAAqBX,KAArB,EAA4BJ,UAA5B,EAAwCY,SAAxC,EAAmDV,IAAnD,EAAyD;AACvD,QAAIU,UAAUvC,MAAV,KAAqB,CAAzB,EAA4B;AAC1B;AACA,UAAI2C,IAAId,KAAKU,UAAUvC,MAAf,CAAR;AACA,UAAI2C,KAAKA,MAAM,GAAX,IAAkBA,MAAM,GAA5B,EAAiC,OAAOxD,KAAKwC,UAAL,CAAP;;AAEjC;AACA;AACA3D,YAAM,8BAAN,EAAsCuE,SAAtC,EAAiDtD,IAAIyB,GAArD;AACAI,gBAAUyB,SAAV;AACAtD,UAAIyB,GAAJ,GAAUE,YAAY3B,IAAIyB,GAAJ,CAAQN,MAAR,CAAeQ,UAAUZ,MAAV,GAAmBc,QAAQd,MAA1C,CAAtB;;AAEA;AACA,UAAI,CAACY,SAAD,IAAc3B,IAAIyB,GAAJ,CAAQ,CAAR,MAAe,GAAjC,EAAsC;AACpCzB,YAAIyB,GAAJ,GAAU,MAAMzB,IAAIyB,GAApB;AACAK,qBAAa,IAAb;AACD;;AAED;AACA9B,UAAIkC,OAAJ,GAAcD,aAAaJ,QAAQA,QAAQd,MAAR,GAAiB,CAAzB,MAAgC,GAAhC,GACvBc,QAAQ8B,SAAR,CAAkB,CAAlB,EAAqB9B,QAAQd,MAAR,GAAiB,CAAtC,CADuB,GAEvBc,OAFU,CAAd;AAGD;;AAED9C,UAAM,YAAN,EAAoB+D,MAAMnC,IAA1B,EAAgC2C,SAAhC,EAA2CtD,IAAIyC,WAA/C;;AAEA,QAAIC,UAAJ,EAAgB;AACdI,YAAMc,YAAN,CAAmBlB,UAAnB,EAA+B1C,GAA/B,EAAoCC,GAApC,EAAyCC,IAAzC;AACD,KAFD,MAEO;AACL4C,YAAMU,cAAN,CAAqBxD,GAArB,EAA0BC,GAA1B,EAA+BC,IAA/B;AACD;AACF;AACF,CAxLD;;AA0LA;;;;;AAKAR,MAAM6D,cAAN,GAAuB,SAASA,cAAT,CAAwBT,KAAxB,EAA+Be,MAA/B,EAAuC7D,GAAvC,EAA4CC,GAA5C,EAAiDkC,IAAjD,EAAuD;AAC5E,MAAI/B,SAAS,KAAKA,MAAlB;;AAEA;AACA,MAAI0D,OAAOhB,MAAMgB,IAAjB;;AAEA;AACA,MAAI,CAACA,IAAD,IAASA,KAAK/C,MAAL,KAAgB,CAA7B,EAAgC;AAC9B,WAAOoB,MAAP;AACD;;AAED,MAAIf,IAAI,CAAR;AACA,MAAIT,IAAJ;AACA,MAAIoD,aAAa,CAAjB;AACA,MAAIC,GAAJ;AACA,MAAIC,QAAJ;AACA,MAAIC,cAAJ;AACA,MAAIC,WAAJ;;AAEA;AACA;AACA,WAASzD,KAAT,CAAe6B,GAAf,EAAoB;AAClB,QAAIA,GAAJ,EAAS;AACP,aAAOJ,KAAKI,GAAL,CAAP;AACD;;AAED,QAAInB,KAAK0C,KAAK/C,MAAd,EAAuB;AACrB,aAAOoB,MAAP;AACD;;AAED4B,iBAAa,CAAb;AACAC,UAAMF,KAAK1C,GAAL,CAAN;AACAT,WAAOqD,IAAIrD,IAAX;AACAsD,eAAWjE,IAAII,MAAJ,CAAWO,IAAX,CAAX;AACAuD,qBAAiB9D,OAAOO,IAAP,CAAjB;AACAwD,kBAAcN,OAAOlD,IAAP,CAAd;;AAEA,QAAIsD,aAAaG,SAAb,IAA0B,CAACF,cAA/B,EAA+C;AAC7C,aAAOxD,OAAP;AACD;;AAED;AACA,QAAIyD,gBAAgBA,YAAYpB,KAAZ,KAAsBkB,QAAtB,IACdE,YAAYE,KAAZ,IAAqBF,YAAYE,KAAZ,KAAsB,OAD7C,CAAJ,EAC4D;AAC1D;AACArE,UAAII,MAAJ,CAAWO,IAAX,IAAmBwD,YAAYG,KAA/B;;AAEA;AACA,aAAO5D,MAAMyD,YAAYE,KAAlB,CAAP;AACD;;AAEDR,WAAOlD,IAAP,IAAewD,cAAc;AAC3BE,aAAO,IADoB;AAE3BtB,aAAOkB,QAFoB;AAG3BK,aAAOL;AAHoB,KAA7B;;AAMAM;AACD;;AAED;AACA,WAASA,aAAT,CAAuBhC,GAAvB,EAA4B;AAC1B,QAAI3B,KAAKsD,eAAeH,YAAf,CAAT;;AAEA;AACAI,gBAAYG,KAAZ,GAAoBtE,IAAII,MAAJ,CAAW4D,IAAIrD,IAAf,CAApB;;AAEA,QAAI4B,GAAJ,EAAS;AACP;AACA4B,kBAAYE,KAAZ,GAAoB9B,GAApB;AACA7B,YAAM6B,GAAN;AACA;AACD;;AAED,QAAI,CAAC3B,EAAL,EAAS,OAAOF,OAAP;;AAET,QAAI;AACFE,SAAGZ,GAAH,EAAQC,GAAR,EAAasE,aAAb,EAA4BN,QAA5B,EAAsCD,IAAIrD,IAA1C;AACD,KAFD,CAEE,OAAO6D,CAAP,EAAU;AACVD,oBAAcC,CAAd;AACD;AACF;;AAED9D;AACD,CApFD;;AAsFA;;;;;;;;;;;;;;;AAeAhB,MAAM+E,GAAN,GAAY,SAASA,GAAT,CAAa7D,EAAb,EAAiB;AAC3B,MAAI8D,SAAS,CAAb;AACA,MAAI9B,OAAO,GAAX;;AAEA;AACA;AACA,MAAI,OAAOhC,EAAP,KAAc,UAAlB,EAA8B;AAC5B,QAAI+D,MAAM/D,EAAV;;AAEA,WAAOtB,MAAMsF,OAAN,CAAcD,GAAd,KAAsBA,IAAI5D,MAAJ,KAAe,CAA5C,EAA+C;AAC7C4D,YAAMA,IAAI,CAAJ,CAAN;AACD;;AAED;AACA,QAAI,OAAOA,GAAP,KAAe,UAAnB,EAA+B;AAC7BD,eAAS,CAAT;AACA9B,aAAOhC,EAAP;AACD;AACF;;AAED,MAAIiE,YAAY5F,QAAQI,MAAMyF,IAAN,CAAWC,SAAX,EAAsBL,MAAtB,CAAR,CAAhB;;AAEA,MAAIG,UAAU9D,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,UAAM,IAAIiE,SAAJ,CAAc,6CAAd,CAAN;AACD;;AAED,OAAK,IAAI5D,IAAI,CAAb,EAAgBA,IAAIyD,UAAU9D,MAA9B,EAAsCK,GAAtC,EAA2C;AACzC,QAAIR,KAAKiE,UAAUzD,CAAV,CAAT;;AAEA,QAAI,OAAOR,EAAP,KAAc,UAAlB,EAA8B;AAC5B,YAAM,IAAIoE,SAAJ,CAAc,2DAA2DC,QAAQrE,EAAR,CAAzE,CAAN;AACD;;AAED;AACA7B,UAAM,WAAN,EAAmB6D,IAAnB,EAAyBhC,GAAGD,IAAH,IAAW,aAApC;;AAEA,QAAImC,QAAQ,IAAIlE,KAAJ,CAAUgE,IAAV,EAAgB;AAC1BsC,iBAAW,KAAK5E,aADU;AAE1BE,cAAQ,KAFkB;AAG1B2E,WAAK;AAHqB,KAAhB,EAITvE,EAJS,CAAZ;;AAMAkC,UAAME,KAAN,GAAcoB,SAAd;;AAEA,SAAK3D,KAAL,CAAWI,IAAX,CAAgBiC,KAAhB;AACD;;AAED,SAAO,IAAP;AACD,CAhDD;;AAkDA;;;;;;;;;;;;;AAaApD,MAAMsD,KAAN,GAAc,SAASA,KAAT,CAAeJ,IAAf,EAAqB;AACjC,MAAII,QAAQ,IAAItE,KAAJ,CAAUkE,IAAV,CAAZ;;AAEA,MAAIE,QAAQ,IAAIlE,KAAJ,CAAUgE,IAAV,EAAgB;AAC1BsC,eAAW,KAAK5E,aADU;AAE1BE,YAAQ,KAAKA,MAFa;AAG1B2E,SAAK;AAHqB,GAAhB,EAITnC,MAAMoC,QAAN,CAAeC,IAAf,CAAoBrC,KAApB,CAJS,CAAZ;;AAMAF,QAAME,KAAN,GAAcA,KAAd;;AAEA,OAAKvC,KAAL,CAAWI,IAAX,CAAgBiC,KAAhB;AACA,SAAOE,KAAP;AACD,CAbD;;AAeA;AACAnE,QAAQyG,MAAR,CAAe,KAAf,EAAsBC,OAAtB,CAA8B,UAAS/D,MAAT,EAAgB;AAC5C9B,QAAM8B,MAAN,IAAgB,UAASoB,IAAT,EAAc;AAC5B,QAAII,QAAQ,KAAKA,KAAL,CAAWJ,IAAX,CAAZ;AACAI,UAAMxB,MAAN,EAAcgE,KAAd,CAAoBxC,KAApB,EAA2B3D,MAAMyF,IAAN,CAAWC,SAAX,EAAsB,CAAtB,CAA3B;AACA,WAAO,IAAP;AACD,GAJD;AAKD,CAND;;AAQA;AACA,SAAS3B,aAAT,CAAuBqC,IAAvB,EAA6BC,QAA7B,EAAuC;AACrC,OAAK,IAAItE,IAAI,CAAb,EAAgBA,IAAIsE,SAAS3E,MAA7B,EAAqCK,GAArC,EAA0C;AACxC,QAAII,SAASkE,SAAStE,CAAT,CAAb;AACA,QAAIqE,KAAKE,OAAL,CAAanE,MAAb,MAAyB,CAAC,CAA9B,EAAiC;AAC/BiE,WAAK5E,IAAL,CAAUW,MAAV;AACD;AACF;AACF;;AAED;AACA,SAASqB,WAAT,CAAqB7C,GAArB,EAA0B;AACxB,MAAI;AACF,WAAOd,SAASc,GAAT,EAAc4F,QAArB;AACD,GAFD,CAEE,OAAOrD,GAAP,EAAY;AACZ,WAAO6B,SAAP;AACD;AACF;;AAED;AACA,SAASxC,YAAT,CAAsBH,GAAtB,EAA2B;AACzB,MAAI,OAAOA,GAAP,KAAe,QAAf,IAA2BA,IAAIV,MAAJ,KAAe,CAA1C,IAA+CU,IAAI,CAAJ,MAAW,GAA9D,EAAmE;AACjE,WAAO2C,SAAP;AACD;;AAED,MAAIyB,cAAcpE,IAAIkE,OAAJ,CAAY,GAAZ,CAAlB;AACA,MAAIG,aAAaD,gBAAgB,CAAC,CAAjB,GACbA,WADa,GAEbpE,IAAIV,MAFR;AAGA,MAAIgF,YAAYtE,IAAIN,MAAJ,CAAW,CAAX,EAAc2E,UAAd,EAA0BH,OAA1B,CAAkC,KAAlC,CAAhB;;AAEA,SAAOI,cAAc,CAAC,CAAf,GACHtE,IAAIN,MAAJ,CAAW,CAAX,EAAcM,IAAIkE,OAAJ,CAAY,GAAZ,EAAiB,IAAII,SAArB,CAAd,CADG,GAEH3B,SAFJ;AAGD;;AAED;AACA,SAASa,OAAT,CAAiBe,GAAjB,EAAsB;AACpB,MAAIC,OAAO,OAAOD,GAAlB;;AAEA,MAAIC,SAAS,QAAb,EAAuB;AACrB,WAAOA,IAAP;AACD;;AAED;AACA,SAAOzG,SAASsF,IAAT,CAAckB,GAAd,EACJE,OADI,CACI9G,YADJ,EACkB,IADlB,CAAP;AAED;;AAED;;;;;;;;AAQA,SAAS6D,UAAT,CAAoBH,KAApB,EAA2BF,IAA3B,EAAiC;AAC/B,MAAI;AACF,WAAOE,MAAMC,KAAN,CAAYH,IAAZ,CAAP;AACD,GAFD,CAEE,OAAOL,GAAP,EAAY;AACZ,WAAOA,GAAP;AACD;AACF;;AAED;AACA,SAAShC,WAAT,CAAqBH,MAArB,EAA6B+F,MAA7B,EAAqC;AACnC,MAAI,OAAOA,MAAP,KAAkB,QAAlB,IAA8B,CAACA,MAAnC,EAA2C;AACzC,WAAO/F,MAAP;AACD;;AAED;AACA,MAAI4F,MAAMlH,MAAM,EAAN,EAAUqH,MAAV,CAAV;;AAEA;AACA,MAAI,EAAE,KAAK/F,MAAP,KAAkB,EAAE,KAAK+F,MAAP,CAAtB,EAAsC;AACpC,WAAOrH,MAAMkH,GAAN,EAAW5F,MAAX,CAAP;AACD;;AAED,MAAIgB,IAAI,CAAR;AACA,MAAIgF,IAAI,CAAR;;AAEA;AACA,SAAOhF,KAAKhB,MAAZ,EAAoB;AAClBgB;AACD;;AAED,SAAOgF,KAAKD,MAAZ,EAAoB;AAClBC;AACD;;AAED;AACA,OAAKhF,GAAL,EAAUA,KAAK,CAAf,EAAkBA,GAAlB,EAAuB;AACrBhB,WAAOgB,IAAIgF,CAAX,IAAgBhG,OAAOgB,CAAP,CAAhB;;AAEA;AACA,QAAIA,IAAIgF,CAAR,EAAW;AACT,aAAOhG,OAAOgB,CAAP,CAAP;AACD;AACF;;AAED,SAAOtC,MAAMkH,GAAN,EAAW5F,MAAX,CAAP;AACD;;AAED;AACA,SAASgC,OAAT,CAAiBxB,EAAjB,EAAqBoF,GAArB,EAA0B;AACxB,MAAIK,QAAQ,IAAI/G,KAAJ,CAAUyF,UAAUhE,MAAV,GAAmB,CAA7B,CAAZ;AACA,MAAIuF,OAAO,IAAIhH,KAAJ,CAAUyF,UAAUhE,MAAV,GAAmB,CAA7B,CAAX;;AAEA,OAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIiF,MAAMtF,MAA1B,EAAkCK,GAAlC,EAAuC;AACrCiF,UAAMjF,CAAN,IAAW2D,UAAU3D,IAAI,CAAd,CAAX;AACAkF,SAAKlF,CAAL,IAAU4E,IAAIK,MAAMjF,CAAN,CAAJ,CAAV;AACD;;AAED,SAAO,YAAY;AACjB;AACA,SAAK,IAAIA,IAAI,CAAb,EAAgBA,IAAIiF,MAAMtF,MAA1B,EAAkCK,GAAlC,EAAuC;AACrC4E,UAAIK,MAAMjF,CAAN,CAAJ,IAAgBkF,KAAKlF,CAAL,CAAhB;AACD;;AAED,WAAOR,GAAG4E,KAAH,CAAS,IAAT,EAAeT,SAAf,CAAP;AACD,GAPD;AAQD;;AAED;AACA,SAASvC,mBAAT,CAA6BvC,GAA7B,EAAkCJ,OAAlC,EAA2CK,IAA3C,EAAiD;AAC/C,MAAI;AACF,QAAIqG,OAAO1G,QAAQ2G,IAAR,CAAa,GAAb,CAAX;AACAvG,QAAIwG,GAAJ,CAAQ,OAAR,EAAiBF,IAAjB;AACAtG,QAAIyG,IAAJ,CAASH,IAAT;AACD,GAJD,CAIE,OAAOhE,GAAP,EAAY;AACZrC,SAAKqC,GAAL;AACD;AACF;;AAED;AACA,SAASF,IAAT,CAAcC,GAAd,EAAmB1B,EAAnB,EAAuB;AACrB,SAAO,SAAS+F,KAAT,GAAiB;AACtB,QAAIC,OAAO,IAAItH,KAAJ,CAAUyF,UAAUhE,MAAV,GAAmB,CAA7B,CAAX;;AAEA6F,SAAK,CAAL,IAAUtE,GAAV;AACA,SAAK,IAAIlB,IAAI,CAAR,EAAWN,MAAMiE,UAAUhE,MAAhC,EAAwCK,IAAIN,GAA5C,EAAiDM,GAAjD,EAAsD;AACpDwF,WAAKxF,IAAI,CAAT,IAAc2D,UAAU3D,CAAV,CAAd;AACD;;AAEDR,OAAG4E,KAAH,CAAS,IAAT,EAAeoB,IAAf;AACD,GATD;AAUD","file":"index.js","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar Route = require('./route');\nvar Layer = require('./layer');\nvar methods = require('methods');\nvar mixin = require('utils-merge');\nvar debug = require('debug')('express:router');\nvar deprecate = require('depd')('express');\nvar flatten = require('array-flatten');\nvar parseUrl = require('parseurl');\nvar setPrototypeOf = require('setprototypeof')\n\n/**\n * Module variables.\n * @private\n */\n\nvar objectRegExp = /^\\[object (\\S+)\\]$/;\nvar slice = Array.prototype.slice;\nvar toString = Object.prototype.toString;\n\n/**\n * Initialize a new `Router` with the given `options`.\n *\n * @param {Object} [options]\n * @return {Router} which is an callable function\n * @public\n */\n\nvar proto = module.exports = function(options) {\n  var opts = options || {};\n\n  function router(req, res, next) {\n    router.handle(req, res, next);\n  }\n\n  // mixin Router class functions\n  setPrototypeOf(router, proto)\n\n  router.params = {};\n  router._params = [];\n  router.caseSensitive = opts.caseSensitive;\n  router.mergeParams = opts.mergeParams;\n  router.strict = opts.strict;\n  router.stack = [];\n\n  return router;\n};\n\n/**\n * Map the given param placeholder `name`(s) to the given callback.\n *\n * Parameter mapping is used to provide pre-conditions to routes\n * which use normalized placeholders. For example a _:user_id_ parameter\n * could automatically load a user's information from the database without\n * any additional code,\n *\n * The callback uses the same signature as middleware, the only difference\n * being that the value of the placeholder is passed, in this case the _id_\n * of the user. Once the `next()` function is invoked, just like middleware\n * it will continue on to execute the route, or subsequent parameter functions.\n *\n * Just like in middleware, you must either respond to the request or call next\n * to avoid stalling the request.\n *\n *  app.param('user_id', function(req, res, next, id){\n *    User.find(id, function(err, user){\n *      if (err) {\n *        return next(err);\n *      } else if (!user) {\n *        return next(new Error('failed to load user'));\n *      }\n *      req.user = user;\n *      next();\n *    });\n *  });\n *\n * @param {String} name\n * @param {Function} fn\n * @return {app} for chaining\n * @public\n */\n\nproto.param = function param(name, fn) {\n  // param logic\n  if (typeof name === 'function') {\n    deprecate('router.param(fn): Refactor to use path params');\n    this._params.push(name);\n    return;\n  }\n\n  // apply param functions\n  var params = this._params;\n  var len = params.length;\n  var ret;\n\n  if (name[0] === ':') {\n    deprecate('router.param(' + JSON.stringify(name) + ', fn): Use router.param(' + JSON.stringify(name.substr(1)) + ', fn) instead');\n    name = name.substr(1);\n  }\n\n  for (var i = 0; i < len; ++i) {\n    if (ret = params[i](name, fn)) {\n      fn = ret;\n    }\n  }\n\n  // ensure we end up with a\n  // middleware function\n  if ('function' !== typeof fn) {\n    throw new Error('invalid param() call for ' + name + ', got ' + fn);\n  }\n\n  (this.params[name] = this.params[name] || []).push(fn);\n  return this;\n};\n\n/**\n * Dispatch a req, res into the router.\n * @private\n */\n\nproto.handle = function handle(req, res, out) {\n  var self = this;\n\n  debug('dispatching %s %s', req.method, req.url);\n\n  var idx = 0;\n  var protohost = getProtohost(req.url) || ''\n  var removed = '';\n  var slashAdded = false;\n  var paramcalled = {};\n\n  // store options for OPTIONS request\n  // only used if OPTIONS request\n  var options = [];\n\n  // middleware and routes\n  var stack = self.stack;\n\n  // manage inter-router variables\n  var parentParams = req.params;\n  var parentUrl = req.baseUrl || '';\n  var done = restore(out, req, 'baseUrl', 'next', 'params');\n\n  // setup next layer\n  req.next = next;\n\n  // for options requests, respond with a default if nothing else responds\n  if (req.method === 'OPTIONS') {\n    done = wrap(done, function(old, err) {\n      if (err || options.length === 0) return old(err);\n      sendOptionsResponse(res, options, old);\n    });\n  }\n\n  // setup basic req values\n  req.baseUrl = parentUrl;\n  req.originalUrl = req.originalUrl || req.url;\n\n  next();\n\n  function next(err) {\n    var layerError = err === 'route'\n      ? null\n      : err;\n\n    // remove added slash\n    if (slashAdded) {\n      req.url = req.url.substr(1);\n      slashAdded = false;\n    }\n\n    // restore altered req.url\n    if (removed.length !== 0) {\n      req.baseUrl = parentUrl;\n      req.url = protohost + removed + req.url.substr(protohost.length);\n      removed = '';\n    }\n\n    // signal to exit router\n    if (layerError === 'router') {\n      setImmediate(done, null)\n      return\n    }\n\n    // no more matching layers\n    if (idx >= stack.length) {\n      setImmediate(done, layerError);\n      return;\n    }\n\n    // get pathname of request\n    var path = getPathname(req);\n\n    if (path == null) {\n      return done(layerError);\n    }\n\n    // find next matching layer\n    var layer;\n    var match;\n    var route;\n\n    while (match !== true && idx < stack.length) {\n      layer = stack[idx++];\n      match = matchLayer(layer, path);\n      route = layer.route;\n\n      if (typeof match !== 'boolean') {\n        // hold on to layerError\n        layerError = layerError || match;\n      }\n\n      if (match !== true) {\n        continue;\n      }\n\n      if (!route) {\n        // process non-route handlers normally\n        continue;\n      }\n\n      if (layerError) {\n        // routes do not match with a pending error\n        match = false;\n        continue;\n      }\n\n      var method = req.method;\n      var has_method = route._handles_method(method);\n\n      // build up automatic options response\n      if (!has_method && method === 'OPTIONS') {\n        appendMethods(options, route._options());\n      }\n\n      // don't even bother matching route\n      if (!has_method && method !== 'HEAD') {\n        match = false;\n        continue;\n      }\n    }\n\n    // no match\n    if (match !== true) {\n      return done(layerError);\n    }\n\n    // store route for dispatch on change\n    if (route) {\n      req.route = route;\n    }\n\n    // Capture one-time layer values\n    req.params = self.mergeParams\n      ? mergeParams(layer.params, parentParams)\n      : layer.params;\n    var layerPath = layer.path;\n\n    // this should be done for the layer\n    self.process_params(layer, paramcalled, req, res, function (err) {\n      if (err) {\n        return next(layerError || err);\n      }\n\n      if (route) {\n        return layer.handle_request(req, res, next);\n      }\n\n      trim_prefix(layer, layerError, layerPath, path);\n    });\n  }\n\n  function trim_prefix(layer, layerError, layerPath, path) {\n    if (layerPath.length !== 0) {\n      // Validate path breaks on a path separator\n      var c = path[layerPath.length]\n      if (c && c !== '/' && c !== '.') return next(layerError)\n\n      // Trim off the part of the url that matches the route\n      // middleware (.use stuff) needs to have the path stripped\n      debug('trim prefix (%s) from url %s', layerPath, req.url);\n      removed = layerPath;\n      req.url = protohost + req.url.substr(protohost.length + removed.length);\n\n      // Ensure leading slash\n      if (!protohost && req.url[0] !== '/') {\n        req.url = '/' + req.url;\n        slashAdded = true;\n      }\n\n      // Setup base URL (no trailing slash)\n      req.baseUrl = parentUrl + (removed[removed.length - 1] === '/'\n        ? removed.substring(0, removed.length - 1)\n        : removed);\n    }\n\n    debug('%s %s : %s', layer.name, layerPath, req.originalUrl);\n\n    if (layerError) {\n      layer.handle_error(layerError, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n  }\n};\n\n/**\n * Process any parameters for the layer.\n * @private\n */\n\nproto.process_params = function process_params(layer, called, req, res, done) {\n  var params = this.params;\n\n  // captured parameters from the layer, keys and values\n  var keys = layer.keys;\n\n  // fast track\n  if (!keys || keys.length === 0) {\n    return done();\n  }\n\n  var i = 0;\n  var name;\n  var paramIndex = 0;\n  var key;\n  var paramVal;\n  var paramCallbacks;\n  var paramCalled;\n\n  // process params in order\n  // param callbacks can be async\n  function param(err) {\n    if (err) {\n      return done(err);\n    }\n\n    if (i >= keys.length ) {\n      return done();\n    }\n\n    paramIndex = 0;\n    key = keys[i++];\n    name = key.name;\n    paramVal = req.params[name];\n    paramCallbacks = params[name];\n    paramCalled = called[name];\n\n    if (paramVal === undefined || !paramCallbacks) {\n      return param();\n    }\n\n    // param previously called with same value or error occurred\n    if (paramCalled && (paramCalled.match === paramVal\n      || (paramCalled.error && paramCalled.error !== 'route'))) {\n      // restore value\n      req.params[name] = paramCalled.value;\n\n      // next param\n      return param(paramCalled.error);\n    }\n\n    called[name] = paramCalled = {\n      error: null,\n      match: paramVal,\n      value: paramVal\n    };\n\n    paramCallback();\n  }\n\n  // single param callbacks\n  function paramCallback(err) {\n    var fn = paramCallbacks[paramIndex++];\n\n    // store updated value\n    paramCalled.value = req.params[key.name];\n\n    if (err) {\n      // store error\n      paramCalled.error = err;\n      param(err);\n      return;\n    }\n\n    if (!fn) return param();\n\n    try {\n      fn(req, res, paramCallback, paramVal, key.name);\n    } catch (e) {\n      paramCallback(e);\n    }\n  }\n\n  param();\n};\n\n/**\n * Use the given middleware function, with optional path, defaulting to \"/\".\n *\n * Use (like `.all`) will run for any http METHOD, but it will not add\n * handlers for those methods so OPTIONS requests will not consider `.use`\n * functions even if they could respond.\n *\n * The other difference is that _route_ path is stripped and not visible\n * to the handler function. The main effect of this feature is that mounted\n * handlers can operate without any code changes regardless of the \"prefix\"\n * pathname.\n *\n * @public\n */\n\nproto.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate router.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var callbacks = flatten(slice.call(arguments, offset));\n\n  if (callbacks.length === 0) {\n    throw new TypeError('Router.use() requires a middleware function')\n  }\n\n  for (var i = 0; i < callbacks.length; i++) {\n    var fn = callbacks[i];\n\n    if (typeof fn !== 'function') {\n      throw new TypeError('Router.use() requires a middleware function but got a ' + gettype(fn))\n    }\n\n    // add the middleware\n    debug('use %o %s', path, fn.name || '<anonymous>')\n\n    var layer = new Layer(path, {\n      sensitive: this.caseSensitive,\n      strict: false,\n      end: false\n    }, fn);\n\n    layer.route = undefined;\n\n    this.stack.push(layer);\n  }\n\n  return this;\n};\n\n/**\n * Create a new Route for the given path.\n *\n * Each route contains a separate middleware stack and VERB handlers.\n *\n * See the Route api documentation for details on adding handlers\n * and middleware to routes.\n *\n * @param {String} path\n * @return {Route}\n * @public\n */\n\nproto.route = function route(path) {\n  var route = new Route(path);\n\n  var layer = new Layer(path, {\n    sensitive: this.caseSensitive,\n    strict: this.strict,\n    end: true\n  }, route.dispatch.bind(route));\n\n  layer.route = route;\n\n  this.stack.push(layer);\n  return route;\n};\n\n// create Router#VERB functions\nmethods.concat('all').forEach(function(method){\n  proto[method] = function(path){\n    var route = this.route(path)\n    route[method].apply(route, slice.call(arguments, 1));\n    return this;\n  };\n});\n\n// append methods to a list of methods\nfunction appendMethods(list, addition) {\n  for (var i = 0; i < addition.length; i++) {\n    var method = addition[i];\n    if (list.indexOf(method) === -1) {\n      list.push(method);\n    }\n  }\n}\n\n// get pathname of request\nfunction getPathname(req) {\n  try {\n    return parseUrl(req).pathname;\n  } catch (err) {\n    return undefined;\n  }\n}\n\n// Get get protocol + host for a URL\nfunction getProtohost(url) {\n  if (typeof url !== 'string' || url.length === 0 || url[0] === '/') {\n    return undefined\n  }\n\n  var searchIndex = url.indexOf('?')\n  var pathLength = searchIndex !== -1\n    ? searchIndex\n    : url.length\n  var fqdnIndex = url.substr(0, pathLength).indexOf('://')\n\n  return fqdnIndex !== -1\n    ? url.substr(0, url.indexOf('/', 3 + fqdnIndex))\n    : undefined\n}\n\n// get type for error message\nfunction gettype(obj) {\n  var type = typeof obj;\n\n  if (type !== 'object') {\n    return type;\n  }\n\n  // inspect [[Class]] for objects\n  return toString.call(obj)\n    .replace(objectRegExp, '$1');\n}\n\n/**\n * Match path to a layer.\n *\n * @param {Layer} layer\n * @param {string} path\n * @private\n */\n\nfunction matchLayer(layer, path) {\n  try {\n    return layer.match(path);\n  } catch (err) {\n    return err;\n  }\n}\n\n// merge params with parent params\nfunction mergeParams(params, parent) {\n  if (typeof parent !== 'object' || !parent) {\n    return params;\n  }\n\n  // make copy of parent for base\n  var obj = mixin({}, parent);\n\n  // simple non-numeric merging\n  if (!(0 in params) || !(0 in parent)) {\n    return mixin(obj, params);\n  }\n\n  var i = 0;\n  var o = 0;\n\n  // determine numeric gaps\n  while (i in params) {\n    i++;\n  }\n\n  while (o in parent) {\n    o++;\n  }\n\n  // offset numeric indices in params before merge\n  for (i--; i >= 0; i--) {\n    params[i + o] = params[i];\n\n    // create holes for the merge when necessary\n    if (i < o) {\n      delete params[i];\n    }\n  }\n\n  return mixin(obj, params);\n}\n\n// restore obj props after function\nfunction restore(fn, obj) {\n  var props = new Array(arguments.length - 2);\n  var vals = new Array(arguments.length - 2);\n\n  for (var i = 0; i < props.length; i++) {\n    props[i] = arguments[i + 2];\n    vals[i] = obj[props[i]];\n  }\n\n  return function () {\n    // restore vals\n    for (var i = 0; i < props.length; i++) {\n      obj[props[i]] = vals[i];\n    }\n\n    return fn.apply(this, arguments);\n  };\n}\n\n// send an OPTIONS response\nfunction sendOptionsResponse(res, options, next) {\n  try {\n    var body = options.join(',');\n    res.set('Allow', body);\n    res.send(body);\n  } catch (err) {\n    next(err);\n  }\n}\n\n// wrap a function\nfunction wrap(old, fn) {\n  return function proxy() {\n    var args = new Array(arguments.length + 1);\n\n    args[0] = old;\n    for (var i = 0, len = arguments.length; i < len; i++) {\n      args[i + 1] = arguments[i];\n    }\n\n    fn.apply(this, args);\n  };\n}\n"]}