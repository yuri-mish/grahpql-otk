{"version":3,"sources":["../../../../node_modules/express/lib/utils.js"],"names":["Buffer","require","contentDisposition","contentType","deprecate","flatten","mime","etag","proxyaddr","qs","querystring","exports","createETagGenerator","weak","wetag","isAbsolute","path","substring","function","normalizeType","type","indexOf","acceptParams","value","lookup","params","normalizeTypes","types","ret","i","length","push","str","index","parts","split","quality","originalIndex","pms","parseFloat","compileETag","val","fn","TypeError","compileQueryParser","parse","newObject","parseExtendedQueryString","compileTrust","a","compile","setCharset","charset","parsed","parameters","format","options","generateETag","body","encoding","buf","isBuffer","from","allowPrototypes"],"mappings":"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","file":"utils.js","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @api private\n */\n\nvar Buffer = require('safe-buffer').Buffer\nvar contentDisposition = require('content-disposition');\nvar contentType = require('content-type');\nvar deprecate = require('depd')('express');\nvar flatten = require('array-flatten');\nvar mime = require('send').mime;\nvar etag = require('etag');\nvar proxyaddr = require('proxy-addr');\nvar qs = require('qs');\nvar querystring = require('querystring');\n\n/**\n * Return strong ETag for `body`.\n *\n * @param {String|Buffer} body\n * @param {String} [encoding]\n * @return {String}\n * @api private\n */\n\nexports.etag = createETagGenerator({ weak: false })\n\n/**\n * Return weak ETag for `body`.\n *\n * @param {String|Buffer} body\n * @param {String} [encoding]\n * @return {String}\n * @api private\n */\n\nexports.wetag = createETagGenerator({ weak: true })\n\n/**\n * Check if `path` looks absolute.\n *\n * @param {String} path\n * @return {Boolean}\n * @api private\n */\n\nexports.isAbsolute = function(path){\n  if ('/' === path[0]) return true;\n  if (':' === path[1] && ('\\\\' === path[2] || '/' === path[2])) return true; // Windows device path\n  if ('\\\\\\\\' === path.substring(0, 2)) return true; // Microsoft Azure absolute path\n};\n\n/**\n * Flatten the given `arr`.\n *\n * @param {Array} arr\n * @return {Array}\n * @api private\n */\n\nexports.flatten = deprecate.function(flatten,\n  'utils.flatten: use array-flatten npm module instead');\n\n/**\n * Normalize the given `type`, for example \"html\" becomes \"text/html\".\n *\n * @param {String} type\n * @return {Object}\n * @api private\n */\n\nexports.normalizeType = function(type){\n  return ~type.indexOf('/')\n    ? acceptParams(type)\n    : { value: mime.lookup(type), params: {} };\n};\n\n/**\n * Normalize `types`, for example \"html\" becomes \"text/html\".\n *\n * @param {Array} types\n * @return {Array}\n * @api private\n */\n\nexports.normalizeTypes = function(types){\n  var ret = [];\n\n  for (var i = 0; i < types.length; ++i) {\n    ret.push(exports.normalizeType(types[i]));\n  }\n\n  return ret;\n};\n\n/**\n * Generate Content-Disposition header appropriate for the filename.\n * non-ascii filenames are urlencoded and a filename* parameter is added\n *\n * @param {String} filename\n * @return {String}\n * @api private\n */\n\nexports.contentDisposition = deprecate.function(contentDisposition,\n  'utils.contentDisposition: use content-disposition npm module instead');\n\n/**\n * Parse accept params `str` returning an\n * object with `.value`, `.quality` and `.params`.\n * also includes `.originalIndex` for stable sorting\n *\n * @param {String} str\n * @return {Object}\n * @api private\n */\n\nfunction acceptParams(str, index) {\n  var parts = str.split(/ *; */);\n  var ret = { value: parts[0], quality: 1, params: {}, originalIndex: index };\n\n  for (var i = 1; i < parts.length; ++i) {\n    var pms = parts[i].split(/ *= */);\n    if ('q' === pms[0]) {\n      ret.quality = parseFloat(pms[1]);\n    } else {\n      ret.params[pms[0]] = pms[1];\n    }\n  }\n\n  return ret;\n}\n\n/**\n * Compile \"etag\" value to function.\n *\n * @param  {Boolean|String|Function} val\n * @return {Function}\n * @api private\n */\n\nexports.compileETag = function(val) {\n  var fn;\n\n  if (typeof val === 'function') {\n    return val;\n  }\n\n  switch (val) {\n    case true:\n      fn = exports.wetag;\n      break;\n    case false:\n      break;\n    case 'strong':\n      fn = exports.etag;\n      break;\n    case 'weak':\n      fn = exports.wetag;\n      break;\n    default:\n      throw new TypeError('unknown value for etag function: ' + val);\n  }\n\n  return fn;\n}\n\n/**\n * Compile \"query parser\" value to function.\n *\n * @param  {String|Function} val\n * @return {Function}\n * @api private\n */\n\nexports.compileQueryParser = function compileQueryParser(val) {\n  var fn;\n\n  if (typeof val === 'function') {\n    return val;\n  }\n\n  switch (val) {\n    case true:\n      fn = querystring.parse;\n      break;\n    case false:\n      fn = newObject;\n      break;\n    case 'extended':\n      fn = parseExtendedQueryString;\n      break;\n    case 'simple':\n      fn = querystring.parse;\n      break;\n    default:\n      throw new TypeError('unknown value for query parser function: ' + val);\n  }\n\n  return fn;\n}\n\n/**\n * Compile \"proxy trust\" value to function.\n *\n * @param  {Boolean|String|Number|Array|Function} val\n * @return {Function}\n * @api private\n */\n\nexports.compileTrust = function(val) {\n  if (typeof val === 'function') return val;\n\n  if (val === true) {\n    // Support plain true/false\n    return function(){ return true };\n  }\n\n  if (typeof val === 'number') {\n    // Support trusting hop count\n    return function(a, i){ return i < val };\n  }\n\n  if (typeof val === 'string') {\n    // Support comma-separated values\n    val = val.split(/ *, */);\n  }\n\n  return proxyaddr.compile(val || []);\n}\n\n/**\n * Set the charset in a given Content-Type string.\n *\n * @param {String} type\n * @param {String} charset\n * @return {String}\n * @api private\n */\n\nexports.setCharset = function setCharset(type, charset) {\n  if (!type || !charset) {\n    return type;\n  }\n\n  // parse type\n  var parsed = contentType.parse(type);\n\n  // set charset\n  parsed.parameters.charset = charset;\n\n  // format type\n  return contentType.format(parsed);\n};\n\n/**\n * Create an ETag generator function, generating ETags with\n * the given options.\n *\n * @param {object} options\n * @return {function}\n * @private\n */\n\nfunction createETagGenerator (options) {\n  return function generateETag (body, encoding) {\n    var buf = !Buffer.isBuffer(body)\n      ? Buffer.from(body, encoding)\n      : body\n\n    return etag(buf, options)\n  }\n}\n\n/**\n * Parse an extended query string with qs.\n *\n * @return {Object}\n * @private\n */\n\nfunction parseExtendedQueryString(str) {\n  return qs.parse(str, {\n    allowPrototypes: true\n  });\n}\n\n/**\n * Return new empty object.\n *\n * @return {Object}\n * @api private\n */\n\nfunction newObject() {\n  return {};\n}\n"]}